import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,b as n,o as t}from"./app-BMihMyie.js";const h={};function k(l,i){return t(),a("div",null,[...i[0]||(i[0]=[n(`<p><code>JNIEnv</code> ( aka <code>const struct JNINativeInterface*</code>, defined in <code>jni.h</code> ) provides a rich interface for accessing Java variables and methods in C/C++. All interfaces are members of <code>struct.JNINativeInterface</code>. You can read <code>jni.h</code> for more details.</p><h2 id="use-jnienv-in-c-c" tabindex="-1"><a class="header-anchor" href="#use-jnienv-in-c-c"><span>Use <code>JNIEnv</code> in C/C++</span></a></h2><div class="hint-container info"><p class="hint-container-title">Info</p><p>The <code>jni.h</code> bundled in the <code>NDK LLVM toolchain</code> is usually located at <code>\${ANDROID_NDK}/toolchains/llvm/prebuilt/linux-x86_64/sysroot/usr/include/jni.h</code>.</p></div><p>Here is a simple example showing how to use <code>JNIEnv</code>. In the example below, you need to pass the Class ID and Method ID to the interface so that <code>JNI</code> will call the appropriate method for you.</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-c"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">jfloat </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">J4AC_android_media_AudioTrack__getMaxVolume</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">JNIEnv </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">env</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">env)-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CallStaticFloatMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      env, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class_J4AC_android_media_AudioTrack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">      class_J4AC_android_media_AudioTrack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">method_getMaxVolume</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="how-jnienv-is-called-in-llvm-ir" tabindex="-1"><a class="header-anchor" href="#how-jnienv-is-called-in-llvm-ir"><span>How <code>JNIEnv</code> Is Called in <code>LLVM IR</code></span></a></h2><p>After translating the example to <code>LLVM IR</code> with <code>-O0</code> option ( no optimization ), we get</p><div class="language-llvm line-numbers-mode" data-highlighter="shiki" data-ext="llvm" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-llvm"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; Function Attrs: noinline nounwind sspstrong uwtable</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">define</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> float</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> @J4AC_android_media_AudioTrack__getMaxVolume</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**) #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> !dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1243</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  %2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">alloca</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">align</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  store</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">** </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*** </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">align</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  call</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> @llvm.dbg.declare</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">metadata</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*** </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">metadata</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> !1246</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DIExpression</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()), </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1247</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  %3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">load</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*** </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">align</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1248</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  %4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">load</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">** </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">align</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1249</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  %5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">getelementptr</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> inbounds</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">* </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i32</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i32</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 135</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1250</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  %6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">load</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> float</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i8*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct._jmethodID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*, ...)*, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">float</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i8*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct._jmethodID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*, ...)** </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">align</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1250</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  %7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">load</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*** </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">align</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1251</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  %8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">load</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> i8*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i8**</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> getelementptr</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> inbounds</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.J4AC_android_media_AudioTrack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.J4AC_android_media_AudioTrack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">* </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@class_J4AC_android_media_AudioTrack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i32</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i32</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">align</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1252</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  %9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">load</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %struct._jmethodID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct._jmethodID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">** </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">getelementptr</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> inbounds</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.J4AC_android_media_AudioTrack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.J4AC_android_media_AudioTrack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">* </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@class_J4AC_android_media_AudioTrack</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i32</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i32</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">align</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1253</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  %10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">call</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> float</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i8*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct._jmethodID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*, ...) </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct.JNINativeInterface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">** </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">i8*</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%struct._jmethodID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">* </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">%9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1254</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  ret</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> float</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> %10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">!dbg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> !</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1255</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>%10</code> is a <code>CallInst</code> which calls the <code>CallStaticFloatMethod</code> function. The called operand is a <code>LoadInst</code>, <code>%6</code>, which loads the function from the pointer <code>%5</code>. <code>%5</code> is a pointer to the element in <code>struct.JNINativeInterface</code>. The last operand of the <code>GetElementPtrInst</code> <code>%5</code> is <code>i32 135</code>. With an alignment of 4 ( usually on 32-bit machines ), it means an offset of <code>135 * 4 = 540</code>.</p><p>Therefore, we can obtain the index of <code>struct</code> members like this:</p><div class="language-cpp line-numbers-mode" data-highlighter="shiki" data-ext="cpp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-cpp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> call_inst </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> dyn_cast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">CallInst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">instruction);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">call_inst) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">continue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">outs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;CallInst: &quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;&lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">call_inst </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> load_inst </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> dyn_cast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">LoadInst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">call_inst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getCalledOperand</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">load_inst) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">continue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">outs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;LoadInst: &quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;&lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">load_inst </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> get_element_ptr_inst </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    dyn_cast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">GetElementPtrInst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">load_inst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getPointerOperand</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">get_element_ptr_inst) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">continue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">outs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;GemElementPtrInst: &quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;&lt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">get_element_ptr_inst </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> jni_native_interface </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    dyn_cast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">StructType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">get_element_ptr_inst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getSourceElementType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">jni_native_interface) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">continue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">outs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;StructName: &quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> jni_native_interface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getStructName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">jni_native_interface</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getStructName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;struct.JNINativeInterface&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  continue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">get_element_ptr_inst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getNumIndices</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">continue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">get_element_ptr_inst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hasAllConstantIndices</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">continue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">auto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> dyn_cast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ConstantInt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">get_element_ptr_inst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">idx_begin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">outs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;offset_in_alignment: &quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> index</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getSExtValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference"><span>Reference</span></a></h2>`,12)])])}const d=s(h,[["render",k]]),r=JSON.parse('{"path":"/2022/research/idea/2022-08-11-how-to-filter-jni-interface-in-llvm-ir.html","title":"How To Filter JNI Interface in LLVM IR","lang":"en-US","frontmatter":{"category":["Research"],"date":"2022-08-11T00:00:00.000Z","modified":"2025-09-20T15:07:39.000Z","tags":["C_Cpp","Java","JNI","LLVM"],"title":"How To Filter JNI Interface in LLVM IR","description":"JNIEnv ( aka const struct JNINativeInterface*, defined in jni.h ) provides a rich interface for accessing Java variables and methods in C/C++. All interfaces are members of stru...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How To Filter JNI Interface in LLVM IR\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-08-11T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"liblaf\\",\\"url\\":\\"https://github.com/liblaf\\"}]}"],["meta",{"property":"og:url","content":"https://hope.liblaf.me/2022/research/idea/2022-08-11-how-to-filter-jni-interface-in-llvm-ir.html"}],["meta",{"property":"og:site_name","content":"liblaf"}],["meta",{"property":"og:title","content":"How To Filter JNI Interface in LLVM IR"}],["meta",{"property":"og:description","content":"JNIEnv ( aka const struct JNINativeInterface*, defined in jni.h ) provides a rich interface for accessing Java variables and methods in C/C++. All interfaces are members of stru..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"article:tag","content":"LLVM"}],["meta",{"property":"article:tag","content":"JNI"}],["meta",{"property":"article:tag","content":"Java"}],["meta",{"property":"article:tag","content":"C_Cpp"}],["meta",{"property":"article:published_time","content":"2022-08-11T00:00:00.000Z"}]]},"git":{},"readingTime":{"minutes":1.57,"words":472},"filePathRelative":"2022/research/idea/2022-08-11-how-to-filter-jni-interface-in-llvm-ir.md","excerpt":"<p><code>JNIEnv</code> ( aka <code>const struct JNINativeInterface*</code>, defined in <code>jni.h</code> ) provides a rich interface for accessing Java variables and methods in C/C++. All interfaces are members of <code>struct.JNINativeInterface</code>. You can read <code>jni.h</code> for more details.</p>","autoDesc":true}');export{d as comp,r as data};
