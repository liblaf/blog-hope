import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,b as t,o as a}from"./app-BMihMyie.js";const n={};function l(r,e){return a(),s("div",null,[...e[0]||(e[0]=[t(`<table><thead><tr><th style="text-align:center;">Environment</th><th style="text-align:center;">Version</th></tr></thead><tbody><tr><td style="text-align:center;">Host Processor</td><td style="text-align:center;">Intel® Core™ i7-10710U CPU @ 1.10GHz 1.61 GHz</td></tr><tr><td style="text-align:center;">Host OS</td><td style="text-align:center;">Windows 11 Pro Education 21H2</td></tr><tr><td style="text-align:center;">VMware® Workstation 16 Pro</td><td style="text-align:center;">16.2.2 build-19200509</td></tr><tr><td style="text-align:center;">Virtual Machine OS</td><td style="text-align:center;"><a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/focal/ubuntu-20.04.3-desktop-amd64.iso" target="_blank" rel="noopener noreferrer">Ubuntu 20.04.3 (amd64, Desktop LiveDVD) (tsinghua.edu.cn)</a></td></tr></tbody></table><h2 id="download-the-source-code" tabindex="-1"><a class="header-anchor" href="#download-the-source-code"><span>Download the Source Code</span></a></h2><p>Visit the <a href="https://www.kernel.org/" target="_blank" rel="noopener noreferrer">official kernel website</a> and download the <a href="https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.13.tar.gz" target="_blank" rel="noopener noreferrer">linux-5.13.tar.gz (kernel.org)</a>. The downloaded file contains a compressed source code.</p><h2 id="extract-the-source-code" tabindex="-1"><a class="header-anchor" href="#extract-the-source-code"><span>Extract the Source Code</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --extract</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --gzip</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> linux-5.13.tar.gz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="install-required-packages" tabindex="-1"><a class="header-anchor" href="#install-required-packages"><span>Install Required Packages</span></a></h2><p>Install additional packages before building a kernel. To do so, run this command:<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup><sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build-essential</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flex</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bison</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libelf-dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libssl-dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dwarves</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zstd</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The command we used above installs the following packages:</p><table><thead><tr><th style="text-align:center;"><strong>Package</strong></th><th style="text-align:center;"><strong>Package description</strong></th></tr></thead><tbody><tr><td style="text-align:center;"><code>git</code></td><td style="text-align:center;">Tracks and makes a record of all changes during development in the source code. It also allows reverting the changes.</td></tr><tr><td style="text-align:center;"><code>fakeroot</code></td><td style="text-align:center;">Packaging tool that makes the fake root environment.</td></tr><tr><td style="text-align:center;"><code>build-essential</code></td><td style="text-align:center;">Installs development tools such as C, C++, gcc, and g++.</td></tr><tr><td style="text-align:center;"><code>ncurses-dev</code></td><td style="text-align:center;">Programming library that provides API for the text-based terminals.</td></tr><tr><td style="text-align:center;"><code>xz-utils</code></td><td style="text-align:center;">Provides fast file compression and decompression.</td></tr><tr><td style="text-align:center;"><code>libssl-dev</code></td><td style="text-align:center;">Supports SSL and TSL that encrypt data and make the internet connection secure.</td></tr><tr><td style="text-align:center;"><code>bc</code> (Basic Calculator)</td><td style="text-align:center;">A mathematical scripting language that supports the interactive execution of statements.</td></tr><tr><td style="text-align:center;"><code>flex</code> (Fast Lexical Analyzer Generator)</td><td style="text-align:center;">Generates lexical analyzers that convert characters into tokens.</td></tr><tr><td style="text-align:center;"><code>libelf-dev</code></td><td style="text-align:center;">Issues a shared library for managing ELF files (executable files, core dumps and object code)</td></tr><tr><td style="text-align:center;"><code>bison</code></td><td style="text-align:center;">GNU parser generator that converts grammar description to a C program.</td></tr></tbody></table><h2 id="configure-kernel" tabindex="-1"><a class="header-anchor" href="#configure-kernel"><span>Configure Kernel</span></a></h2><p>The Linux kernel source code comes with the default configuration. However, you can adjust it to your needs. To do so, follow the steps below:</p><p>Navigate to the <code>linux-5.13.0</code>. directory using the <code>cd</code> command:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> linux-5.13.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>To make changes to the configuration file, run the <code>make</code> command:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> menuconfig</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If no <code>.config</code> file exists, defaults found in <code>/boot/config-$(uname -r)</code> will be used. The command launches several scripts, which then open the configuration menu.</p><p>The configuration menu includes options such as firmware, file system, network, and memory settings. Use the arrows to make a selection or choose <strong>Help</strong> to learn more about the options. When you finish making the changes, select <strong>Save</strong>, and then exit the menu.</p><blockquote><p><strong>Note:</strong> Changing settings for some options can lead to a non-functional kernel. If you are unsure what to change, leave the default settings.</p></blockquote><p>In your kernel configuration file you will find this line:<sup class="footnote-ref"><a href="#footnote3">[3]</a><a class="footnote-anchor" id="footnote-ref3"></a></sup></p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-properties"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">CONFIG_SYSTEM_TRUSTED_KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;debian/canonical-certs.pem&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Change it to this:</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-properties"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">CONFIG_SYSTEM_TRUSTED_KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Depending on your source structure you might be able to do it via command line. Examples:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">scripts/config</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --disable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SYSTEM_TRUSTED_KEYS</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>or</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">scripts/config</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --set-str</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SYSTEM_TRUSTED_KEYS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Another key has been added to the default Canonical kernel configuration since this answer was posted:</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-properties"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">CONFIG_SYSTEM_REVOCATION_KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;debian/canonical-revoked-certs.pem&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>So, it also needs to be dealt with for user kernel compiles to complete:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">scripts/config</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --disable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SYSTEM_REVOCATION_KEYS</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="build-the-kernel" tabindex="-1"><a class="header-anchor" href="#build-the-kernel"><span>Build the Kernel</span></a></h2><p>Start building the kernel by running the following command:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --jobs=$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nproc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --all)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>LLVM has substitutes for GNU binutils utilities. Kbuild supports <code>LLVM=1</code> to enable them.<sup class="footnote-ref"><a href="#footnote4">[4]</a><a class="footnote-anchor" id="footnote-ref4"></a></sup></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LLVM=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>They can be enabled individually. The full list of the parameters:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CC=clang-12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LD=ld.lld-12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AR=llvm-ar-12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NM=llvm-nm-12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> STRIP=llvm-strip-12</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  OBJCOPY=llvm-objcopy-12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OBJDUMP=llvm-objdump-12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> READELF=llvm-readelf-12</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  HOSTCC=clang-12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HOSTCXX=clang++-12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HOSTAR=llvm-ar-12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HOSTLD=ld.lld-12</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>Note:</strong> The version of kernel and compiler matters!!! If you cannot pass compilation, try another release of kernel or compiler.</p></blockquote><p>The process of building and compiling the Linux kernel takes some time to complete.</p><p>The terminal lists all Linux kernel components: memory management, hardware device drivers, filesystem drivers, network drivers, and process management.</p><p>Install the required modules with this command:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modules_install</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Finally, install the kernel by typing:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="change-the-default-boot-kernel" tabindex="-1"><a class="header-anchor" href="#change-the-default-boot-kernel"><span>Change the Default Boot Kernel</span></a></h2><p>You may press <code>Esc</code> to enter the boot menu when staring up, but that’s a bit troublesome. Instead, use the following commands to list GRUB’s menu entries:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">awk</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -F</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;$1==&quot;menuentry &quot; || $1==&quot;submenu &quot; {print i++ &quot; : &quot; $2}; /\\tmenuentry / {print &quot;\\t&quot; i-1&quot;&gt;&quot;j++ &quot; : &quot; $2};&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /boot/grub/grub.cfg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>For example, I got the output:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>0 : Ubuntu</span></span>
<span class="line"><span>1 : Advanced options for Ubuntu</span></span>
<span class="line"><span>        1&gt;0 : Ubuntu, with Linux 5.13.0-30-generic</span></span>
<span class="line"><span>        1&gt;1 : Ubuntu, with Linux 5.13.0-30-generic (recovery mode)</span></span>
<span class="line"><span>        1&gt;2 : Ubuntu, with Linux 5.13.0</span></span>
<span class="line"><span>        1&gt;3 : Ubuntu, with Linux 5.13.0 (recovery mode)</span></span>
<span class="line"><span>        1&gt;4 : Ubuntu, with Linux 5.11.0-27-generic</span></span>
<span class="line"><span>        1&gt;5 : Ubuntu, with Linux 5.11.0-27-generic (recovery mode)</span></span>
<span class="line"><span>2 : Memory test (memtest86+)</span></span>
<span class="line"><span>3 : Memory test (memtest86+, serial console 115200)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For me, the desired default kernel to boot from is <code>1&gt;2 : Ubuntu, with Linux 5.13.0</code>. Open the <code>/etc/default/grub</code> file and change the value of <code>GRUB_DEFAULT</code> to <code>&quot;1&gt;2&quot;</code>, like this:<sup class="footnote-ref"><a href="#footnote5">[5]</a><a class="footnote-anchor" id="footnote-ref5"></a></sup></p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-properties"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">GRUB_DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1&gt;2&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>1</code> in <code>1&gt;2</code> indicates the <strong>second</strong> entry of the main menu.</li><li><code>2</code> in <code>1&gt;2</code> indicates the <strong>third</strong> entry of the submenu.</li><li>There is <strong>no space</strong> before and after the greater-than sign (<code>&gt;</code>) in <code>1&gt;2</code>.</li><li>Use a set of quotation marks to enclose <code>1&gt;2</code>.</li></ul><p>Run <code>update-grub</code> afterwards to update <code>/boot/grub/grub.cfg</code>:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update-grub</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If you stuck on <code>Loading inital ramdisk...</code> after reboot, try adding <code>IUCODE_TOOL_INITRAMFS=no</code> to <code>/etc/default/intel-microcode</code> and then re-running <code>update-initramfs -u</code> to remove the microcode bits from the <code>initramfs</code> image.<sup class="footnote-ref"><a href="#footnote6">[6]</a><a class="footnote-anchor" id="footnote-ref6"></a></sup></p><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference"><span>Reference</span></a></h2><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p><a href="https://phoenixnap.com/kb/build-linux-kernel" target="_blank" rel="noopener noreferrer">How To Build Linux Kernel {Step-By-Step} | phoenixNAP KB</a> <a href="#footnote-ref1" class="footnote-backref">↩︎</a></p></li><li id="footnote2" class="footnote-item"><p><a href="https://stackoverflow.com/questions/61657707/btf-tmp-vmlinux-btf-pahole-pahole-is-not-available" target="_blank" rel="noopener noreferrer">compilation - BTF: .tmp_vmlinux.btf: pahole (pahole) is not available - Stack Overflow</a> <a href="#footnote-ref2" class="footnote-backref">↩︎</a></p></li><li id="footnote3" class="footnote-item"><p><a href="https://askubuntu.com/questions/1329538/compiling-the-kernel-5-11-11" target="_blank" rel="noopener noreferrer">Compiling the kernel 5.11.11 - Ask Ubuntu</a> <a href="#footnote-ref3" class="footnote-backref">↩︎</a></p></li><li id="footnote4" class="footnote-item"><p><a href="https://www.kernel.org/doc/html/v5.13/kbuild/llvm.html" target="_blank" rel="noopener noreferrer">Building Linux with Clang/LLVM — The Linux Kernel documentation</a> <a href="#footnote-ref4" class="footnote-backref">↩︎</a></p></li><li id="footnote5" class="footnote-item"><p><a href="https://support.huaweicloud.com/intl/en-us/trouble-ecs/ecs_trouble_0327.html" target="_blank" rel="noopener noreferrer">How Do I Change the Default Boot Kernel in Ubuntu?_Elastic Cloud Server_Troubleshooting_Linux Issues_HUAWEI CLOUD</a> <a href="#footnote-ref5" class="footnote-backref">↩︎</a></p></li><li id="footnote6" class="footnote-item"><p><a href="https://askubuntu.com/questions/1145535/stuck-on-loading-initial-ramdisk-after-upgrading" target="_blank" rel="noopener noreferrer">boot - Stuck on “Loading initial ramdisk…” after upgrading - Ask Ubuntu</a> <a href="#footnote-ref6" class="footnote-backref">↩︎</a></p></li></ol></section>`,59)])])}const h=i(n,[["render",l]]),c=JSON.parse('{"path":"/2022/research/idea/2022-01-26-how-to-build-linux-kernel.html","title":"How to Build Linux Kernel","lang":"en-US","frontmatter":{"category":["Research"],"date":"2022-01-26T00:00:00.000Z","modified":"2025-09-20T15:07:39.000Z","tags":["C_Cpp","Clang","Linux_Kernel","LLVM"],"title":"How to Build Linux Kernel","description":"Download the Source Code Visit the official kernel website and download the linux-5.13.tar.gz (kernel.org). The downloaded file contains a compressed source code. Extract the So...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How to Build Linux Kernel\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-01-26T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"liblaf\\",\\"url\\":\\"https://github.com/liblaf\\"}]}"],["meta",{"property":"og:url","content":"https://hope.liblaf.me/2022/research/idea/2022-01-26-how-to-build-linux-kernel.html"}],["meta",{"property":"og:site_name","content":"liblaf"}],["meta",{"property":"og:title","content":"How to Build Linux Kernel"}],["meta",{"property":"og:description","content":"Download the Source Code Visit the official kernel website and download the linux-5.13.tar.gz (kernel.org). The downloaded file contains a compressed source code. Extract the So..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"article:tag","content":"LLVM"}],["meta",{"property":"article:tag","content":"Linux_Kernel"}],["meta",{"property":"article:tag","content":"Clang"}],["meta",{"property":"article:tag","content":"C_Cpp"}],["meta",{"property":"article:published_time","content":"2022-01-26T00:00:00.000Z"}]]},"git":{},"readingTime":{"minutes":3.5,"words":1051},"filePathRelative":"2022/research/idea/2022-01-26-how-to-build-linux-kernel.md","excerpt":"<table>\\n<thead>\\n<tr>\\n<th style=\\"text-align:center\\">Environment</th>\\n<th style=\\"text-align:center\\">Version</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td style=\\"text-align:center\\">Host Processor</td>\\n<td style=\\"text-align:center\\">Intel® Core™ i7-10710U CPU @ 1.10GHz 1.61 GHz</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">Host OS</td>\\n<td style=\\"text-align:center\\">Windows 11 Pro Education 21H2</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">VMware® Workstation 16 Pro</td>\\n<td style=\\"text-align:center\\">16.2.2 build-19200509</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">Virtual Machine OS</td>\\n<td style=\\"text-align:center\\"><a href=\\"https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/focal/ubuntu-20.04.3-desktop-amd64.iso\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Ubuntu 20.04.3 (amd64, Desktop LiveDVD) (tsinghua.edu.cn)</a></td>\\n</tr>\\n</tbody>\\n</table>","autoDesc":true}');export{h as comp,c as data};
